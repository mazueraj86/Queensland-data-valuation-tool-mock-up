<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Valuation Tool</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .input-group {
            @apply flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 items-center;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">

    <div class="max-w-5xl mx-auto bg-white shadow-xl rounded-2xl overflow-hidden p-8">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-2">Data Asset Valuation</h1>
            <p class="text-xl text-gray-600">Social Cost-Benefit Analysis (SCBA) Framework</p>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-4 gap-8">
            <!-- Project Inputs Section -->
            <div class="md:col-span-1 space-y-6">
                <section class="bg-blue-50 p-6 rounded-xl border border-blue-200">
                    <h2 class="text-2xl font-semibold text-blue-800 mb-4">Project Inputs</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="initialInvestment" class="block text-sm font-medium text-gray-700">Initial Investment (AU$)</label>
                            <input type="number" id="initialInvestment" value="100000" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
                        </div>
                        <div>
                            <label for="discountRate" class="block text-sm font-medium text-gray-700">Discount Rate (%)</label>
                            <input type="number" id="discountRate" value="5" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
                        </div>
                    </div>
                    <div class="mt-6">
                        <label for="periods" class="block text-sm font-medium text-gray-700">Number of Periods</label>
                        <div class="flex items-center space-x-4 mt-1">
                            <input type="range" id="periods" min="1" max="10" value="5" class="w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer">
                            <span id="periodsValue" class="text-lg font-bold text-blue-800">5</span>
                        </div>
                    </div>
                </section>
                
                <section class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4 text-center">Calculation Results</h2>
                    <div class="space-y-4">
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <p class="text-lg font-medium text-gray-700">Total Net Present Value (NPV)</p>
                            <p id="npvResult" class="text-3xl font-bold text-gray-900 mt-1">$0.00</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <p class="text-lg font-medium text-gray-700">Investment Decision</p>
                            <p id="decisionResult" class="text-xl font-bold text-gray-900 mt-1">
                                Enter values and click 'Calculate'
                            </p>
                        </div>
                    </div>
                </section>
                
            </div>

            <!-- Annual Cash Flows Section -->
            <div class="md:col-span-3 space-y-6">
                <section class="bg-green-50 p-6 rounded-xl border border-green-200">
                    <h2 class="text-2xl font-semibold text-green-800 mb-4 text-center">Annual Costs & Benefits (AU$)</h2>
                    
                    <div class="mb-6 bg-white p-4 rounded-lg shadow-sm">
                        <label for="sameCostsToggle" class="flex items-center cursor-pointer">
                            <div class="relative">
                                <input type="checkbox" id="sameCostsToggle" class="sr-only" checked>
                                <div class="block bg-gray-600 w-14 h-8 rounded-full"></div>
                                <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform"></div>
                            </div>
                            <span class="ml-3 text-gray-700 font-medium">Are ongoing costs the same for all years?</span>
                        </label>
                        <div id="singleCostInput" class="mt-4">
                            <label for="ongoingCosts" class="block text-sm font-medium text-gray-700">Annual Ongoing Costs (AU$)</label>
                            <input type="number" id="ongoingCosts" value="20000" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
                        </div>
                        <div id="multipleCostsInput" class="mt-4 hidden space-y-4">
                            <!-- Dynamically generated content for multiple costs -->
                        </div>
                    </div>
                    
                    <div id="annual-cashflows-container">
                        <!-- Dynamically generated content -->
                    </div>
                    <div class="flex justify-center mt-6">
                        <button id="calculateBtn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-blue-700 transition-colors duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-500 focus:ring-opacity-50">
                            Calculate NPV
                        </button>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const periodsInput = document.getElementById('periods');
            const periodsValueSpan = document.getElementById('periodsValue');
            const annualCashflowsContainer = document.getElementById('annual-cashflows-container');
            const calculateBtn = document.getElementById('calculateBtn');
            const npvResult = document.getElementById('npvResult');
            const decisionResult = document.getElementById('decisionResult');
            const sameCostsToggle = document.getElementById('sameCostsToggle');
            const singleCostInput = document.getElementById('singleCostInput');
            const multipleCostsInput = document.getElementById('multipleCostsInput');

            const initialValues = {
                direct: [
                    { desc: 'Cost savings from efficiency', value: 30000, method: 'Historical Data' },
                    { desc: 'Licensing revenue', value: 5000, method: 'Market Analysis' }
                ],
                nonmarket: [
                    { desc: 'Willingness to pay for transparency', value: 15000, score: 8, method: 'Contingent Valuation' },
                    { desc: 'Value of public trust', value: 5000, score: 7, method: 'Willingness to Pay' }
                ],
                spillover: [
                    { desc: 'Value from job creation', value: 5000, score: 6, method: 'Econometric Analysis' },
                    { desc: 'Increased revenue for startups', value: 2000, score: 9, method: 'Growth Projections' }
                ]
            };
            
            const getRandomValue = () => Math.floor(Math.random() * 50000) + 1000;

            const getMethodsForType = (type) => {
                const methods = new Set();
                initialValues[type].forEach(item => methods.add(item.method));
                return Array.from(methods);
            };

            const createBenefitItem = (year, type, desc, value, score, method) => {
                const benefitId = `${type}-${year}-${crypto.randomUUID()}`;
                let valueInput = '';
                if (type === 'direct') {
                    valueInput = `<input type="number" id="${benefitId}" value="${value}" class="flex-none w-32 rounded-md border-gray-300 shadow-sm p-2 text-sm focus:ring-green-500 focus:border-green-500 transition-colors duration-200">`;
                } else {
                    const calculatedValueId = `${benefitId}-calculated`;
                    valueInput = `
                        <input type="number" value="${score}" min="1" max="10" class="score-input flex-none w-16 rounded-md border-gray-300 shadow-sm p-2 text-sm text-center focus:ring-green-500 focus:border-green-500 transition-colors duration-200" oninput="updateCalculatedValue(this)">
                        <span class="text-gray-500 text-lg">x</span>
                        <input type="number" value="${value}" class="estimated-value-input flex-none w-32 rounded-md border-gray-300 shadow-sm p-2 text-sm focus:ring-green-500 focus:border-green-500 transition-colors duration-200" oninput="updateCalculatedValue(this)">
                        <span class="text-gray-500 text-sm">=</span>
                        <span id="${calculatedValueId}" class="flex-none w-32 text-right font-medium text-gray-700 p-2">$0.00</span>
                    `;
                }
                
                const methodOptions = getMethodsForType(type).map(opt => 
                    `<option value="${opt}" ${opt === method ? 'selected' : ''}>${opt}</option>`
                ).join('');

                return `
                    <div class="input-group">
                        <input type="text" placeholder="Description" value="${desc}" class="flex-1 rounded-md border-gray-300 shadow-sm p-2 text-sm focus:ring-green-500 focus:border-green-500 transition-colors duration-200">
                        <select class="flex-1 rounded-md border-gray-300 shadow-sm p-2 text-sm focus:ring-green-500 focus:border-green-500 transition-colors duration-200">
                            <option value="">Select a Method</option>
                            ${methodOptions}
                        </select>
                        ${valueInput}
                    </div>
                `;
            };

            const generateCostInputs = (numPeriods) => {
                multipleCostsInput.innerHTML = '';
                for (let i = 1; i <= numPeriods; i++) {
                    const costRow = document.createElement('div');
                    costRow.className = 'flex items-center space-x-2';
                    costRow.innerHTML = `
                        <label for="ongoingCost-${i}" class="text-sm font-medium text-gray-700 flex-1">Year ${i} Ongoing Costs (AU$)</label>
                        <input type="number" id="ongoingCost-${i}" value="20000" class="flex-none w-48 rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
                    `;
                    multipleCostsInput.appendChild(costRow);
                }
            };

            window.updateCalculatedValue = (inputElement) => {
                const parentDiv = inputElement.closest('.input-group');
                const scoreInput = parentDiv.querySelector('.score-input');
                const estimatedValueInput = parentDiv.querySelector('.estimated-value-input');
                const calculatedValueSpan = parentDiv.querySelector('span[id$="-calculated"]');

                if (scoreInput && estimatedValueInput && calculatedValueSpan) {
                    const score = parseFloat(scoreInput.value) || 0;
                    const estimatedValue = parseFloat(estimatedValueInput.value) || 0;
                    const calculatedValue = (score / 10) * estimatedValue;
                    calculatedValueSpan.textContent = `$${calculatedValue.toFixed(2)}`;
                }
            };

            const generateAnnualCashFlows = (numPeriods) => {
                annualCashflowsContainer.innerHTML = '';
                for (let i = 1; i <= numPeriods; i++) {
                    const yearSection = document.createElement('div');
                    yearSection.className = 'bg-white p-6 rounded-xl shadow-md mb-6';
                    yearSection.innerHTML = `<h3 class="text-xl font-bold text-gray-800 mb-4">Year ${i}</h3>`;
                    
                    const sections = [
                        { id: 'direct', title: 'Direct Benefits' },
                        { id: 'nonmarket', title: 'Non-Market Benefits' },
                        { id: 'spillover', title: 'Spillover Benefits' }
                    ];

                    sections.forEach(section => {
                        const benefitContainer = document.createElement('div');
                        benefitContainer.id = `${section.id}-${i}-container`;
                        benefitContainer.className = 'space-y-2 mb-4';

                        let initialContent = '';
                        const initialData = initialValues[section.id].find(val => val.year === i) || (initialValues[section.id][0] ? {...initialValues[section.id][0], value: getRandomValue(), score: Math.floor(Math.random() * 10) + 1} : {desc: `Example ${section.title}`, value: getRandomValue(), score: Math.floor(Math.random() * 10) + 1, method: ''});

                        initialContent = createBenefitItem(i, section.id, initialData.desc, initialData.value, initialData.score, initialData.method);
                        
                        benefitContainer.innerHTML = `
                            <p class="font-semibold text-gray-700">${section.title}</p>
                            ${initialContent}
                        `;
                        yearSection.appendChild(benefitContainer);

                        const addButton = document.createElement('button');
                        addButton.textContent = `+ Add a ${section.id} benefit`;
                        addButton.className = 'bg-gray-200 text-gray-700 text-sm py-1 px-3 rounded-full hover:bg-gray-300 transition-colors duration-200';
                        addButton.onclick = () => {
                            const newBenefit = document.createElement('div');
                            newBenefit.className = 'input-group mt-2';
                            newBenefit.innerHTML = createBenefitItem(i, section.id, '', getRandomValue(), 5, '');
                            benefitContainer.appendChild(newBenefit);
                            updateCalculatedValue(newBenefit.querySelector('input')); // Recalculate for new row
                        };
                        yearSection.appendChild(addButton);
                    });
                    annualCashflowsContainer.appendChild(yearSection);
                }
            };

            periodsInput.addEventListener('input', (event) => {
                const numPeriods = parseInt(event.target.value);
                periodsValueSpan.textContent = numPeriods;
                generateAnnualCashFlows(numPeriods);
                generateCostInputs(numPeriods);
                updateAllCalculatedValues();
            });

            sameCostsToggle.addEventListener('change', () => {
                if (sameCostsToggle.checked) {
                    singleCostInput.classList.remove('hidden');
                    multipleCostsInput.classList.add('hidden');
                } else {
                    singleCostInput.classList.add('hidden');
                    multipleCostsInput.classList.remove('hidden');
                }
            });

            const updateAllCalculatedValues = () => {
                document.querySelectorAll('.input-group .score-input').forEach(input => {
                    updateCalculatedValue(input);
                });
            };

            calculateBtn.addEventListener('click', () => {
                const initialInvestment = parseFloat(document.getElementById('initialInvestment').value) || 0;
                const discountRate = parseFloat(document.getElementById('discountRate').value) / 100 || 0;
                const years = parseInt(periodsInput.value);
                
                let totalNPV = -initialInvestment;
                
                for (let i = 1; i <= years; i++) {
                    let ongoingCosts;
                    if (sameCostsToggle.checked) {
                        ongoingCosts = parseFloat(document.getElementById('ongoingCosts').value) || 0;
                    } else {
                        ongoingCosts = parseFloat(document.getElementById(`ongoingCost-${i}`).value) || 0;
                    }

                    let directBenefits = 0;
                    const directInputs = document.querySelectorAll(`#direct-${i}-container .input-group input[type="number"]`);
                    directInputs.forEach(input => {
                        directBenefits += parseFloat(input.value) || 0;
                    });
                    
                    let nonmarketBenefits = 0;
                    const nonmarketInputs = document.querySelectorAll(`#nonmarket-${i}-container .input-group`);
                    nonmarketInputs.forEach(group => {
                        const score = parseFloat(group.querySelector('.score-input').value) || 0;
                        const estimatedValue = parseFloat(group.querySelector('.estimated-value-input').value) || 0;
                        nonmarketBenefits += (score / 10) * estimatedValue;
                    });
                    
                    let spilloverBenefits = 0;
                    const spilloverInputs = document.querySelectorAll(`#spillover-${i}-container .input-group`);
                    spilloverInputs.forEach(group => {
                        const score = parseFloat(group.querySelector('.score-input').value) || 0;
                        const estimatedValue = parseFloat(group.querySelector('.estimated-value-input').value) || 0;
                        spilloverBenefits += (score / 10) * estimatedValue;
                    });

                    const totalBenefits = directBenefits + nonmarketBenefits + spilloverBenefits;
                    const netCashFlow = totalBenefits - ongoingCosts; 
                    
                    const presentValue = netCashFlow / Math.pow(1 + discountRate, i);
                    totalNPV += presentValue;
                }
                
                npvResult.textContent = `$${totalNPV.toFixed(2)}`;
                
                if (totalNPV > 0) {
                    decisionResult.textContent = 'Accept Project';
                    decisionResult.classList.remove('text-red-600', 'text-yellow-600');
                    decisionResult.classList.add('text-green-600');
                } else if (totalNPV < 0) {
                    decisionResult.textContent = 'Reject Project';
                    decisionResult.classList.remove('text-green-600', 'text-yellow-600');
                    decisionResult.classList.add('text-red-600');
                } else {
                    decisionResult.textContent = 'Indifferent';
                    decisionResult.classList.remove('text-green-600', 'text-red-600');
                    decisionResult.classList.add('text-yellow-600');
                }
            });

            generateAnnualCashFlows(parseInt(periodsInput.value));
            generateCostInputs(parseInt(periodsInput.value));
            updateAllCalculatedValues();
        });
    </script>
</body>
</html>
